function loginPrivate(){
  const u=document.getElementById("username").value.trim();
  const p=document.getElementById("password").value.trim();
  if(validUsers[u] && validUsers[u]===p){
    username=u; 
    chatType="private"; 
    userId=u+"-"+Math.random().toString(36).slice(2,7);
    privateRoom = "chatables-private/" + u; // unique private path for this user
    loginScreen.style.display="none"; 
    startChat();
  } else alert("Wrong username or password");
}

function sendMessage(){
  const msgBox=$("#msg").data("emojioneArea");
  if(!msgBox) return;
  const text=msgBox.getText().trim();
  if(!text) return;
  let path = chatType==="private" ? privateRoom : "chatables-"+chatType;
  db.ref(path).push({text,user:userId,name:username,time:Date.now()});
  msgBox.setText("");
}

function listenMessages(){
  let path = chatType==="private" ? privateRoom : "chatables-"+chatType;
  db.ref(path).on("child_added", snap=>{
    const d=snap.val(); if(!d) return;
    const me = d.user === userId;
    const date = new Date(d.time);
    let hours = date.getHours(); const minutes=String(date.getMinutes()).padStart(2,'0');
    const ampm=hours>=12?'PM':'AM'; hours=hours%12||12;
    const timeStr=`${hours}:${minutes} ${ampm}`;
    $("#messages").append(`<div class="chat-row"><div class="chat-bubble ${me?"message-you":"message-friend"}"><b>${me?"You":d.name}</b> <span class="timestamp">${timeStr}</span><br>${d.text}</div></div>`);
    document.getElementById("messages").scrollTop=document.getElementById("messages").scrollHeight;
  });
}
